---
alwaysApply: true
---

# FM-UX Coding Conventions

## Stack
- React 18, TypeScript, Vite
- Ant Design components
- Zustand for UI state management
- TanStack Router + React Query
- Vitest + Testing Library for tests
- react-i18next for i18n
- google-map-react for maps (needs mocking in tests)
- recharts for charts (warning about 0 dimensions in tests - ignorable)

## Development Commands (pnpm)

All commands run from the `fm-ux` directory.

### Formatting
```bash
npx prettier --write "src/**/*.{ts,tsx,js,json}"
```

### Type Checking
```bash
pnpm tsc --noEmit          # Check TypeScript without emitting files
```

### Linting
```bash
pnpm lint                  # Run ESLint
pnpm lint:fix              # Run ESLint with auto-fix
pnpm format                # Format code with Prettier
```

### Testing
```bash
pnpm test                           # Run vitest in watch mode
pnpm test:run                        # Run vitest once (CI mode)
pnpm test:run -- src/path/file.test.tsx  # Run a single test file
pnpm test:coverage                   # Run vitest with coverage report
```
Testing conventions and patterns live in `ui-tests.mdc` (not alwaysApply).

### Building
```bash
pnpm build                 # Type check (tsc -b) + Vite production build
pnpm dev                   # Start Vite dev server
pnpm preview               # Preview production build locally
```

## File Conventions
- Components: PascalCase `.tsx`
- Stores: camelCase with `Store` suffix
- Translation files: lowercase `.json` per namespace

## Internationalization (i18n)
- Config: `src/i18n/index.ts`
- Translations: `src/i18n/locales/{en,de}/{common,login,app,home}.json`
- Default language: German (`de`) before login
- Language syncs from `sessionInfo.locale` via `changeLanguage()` in sessionStore
- Use `useTranslation(namespace)` hook in components

## Testing Pattern
- aria-labels use `ns:key` format for deterministic queries: `aria-label="login:signIn"`
- Tests use mocked i18n returning keys: `screen.findByRole('button', { name: 'login:signIn' })`
- Mock in `test/setup.ts` returns `${ns}:${key}` for `t()` calls

## Route Protection
- `__root.tsx` redirects to `/login` if `SessionState !== open`
- Tests for authenticated routes must pre-populate session store (see ui-tests.mdc)

## Definition of Done
1. TypeScript compiles: `pnpm tsc --noEmit`
2. TypeScript no linting errors/warnings anymore: `pnpm lint`
3. Tests pass: `pnpm test:run`
4. Interactive elements have `aria-label="ns:key"` for testing
5. New text uses translation keys, not hardcoded strings
