---
alwaysApply: true
---

# FM-UX Coding Conventions

## Stack
- React 18, TypeScript, Vite
- Ant Design components
- Zustand for UI state management
- TanStack Router + React Query
- Vitest + Testing Library for tests
- react-i18next for i18n
- google-map-react for maps (needs mocking in tests)
- recharts for charts (warning about 0 dimensions in tests - ignorable)

## Development Commands (pnpm)

All commands run from the `fm-ux` directory.

### Formatting
```bash
npx prettier --write "src/**/*.{ts,tsx,js,json}"
```

### Type Checking
```bash
pnpm tsc --noEmit          # Check TypeScript without emitting files
```

### Linting
```bash
pnpm lint                  # Run ESLint
pnpm lint:fix              # Run ESLint with auto-fix
pnpm format                # Format code with Prettier
```

### Testing
```bash
pnpm test                           # Run vitest in watch mode
pnpm test:run                        # Run vitest once (CI mode)
pnpm test:run -- src/path/file.test.tsx  # Run a single test file
pnpm test:coverage                   # Run vitest with coverage report
```
Testing conventions and patterns live in `ui-tests.mdc` (not alwaysApply).

### Building
```bash
pnpm build                 # Type check (tsc -b) + Vite production build
pnpm dev                   # Start Vite dev server
pnpm preview               # Preview production build locally
```

## Definition of Done
1. TypeScript compiles: `pnpm tsc --noEmit`
2. TypeScript no linting errors/warnings anymore: `pnpm lint`
3. Tests pass: `pnpm test:run`
4. Interactive elements have `aria-label="ns:key"` for testing
5. New text uses translation keys, not hardcoded strings

## Dev Server Login (IMPORTANT - Read First for Browser Testing)

When testing UI changes in the browser, follow this login sequence:

### Step 1: Login
- **URL**: http://localhost:5173/
- **Email**: hannes@zeitwert.io
- **Password**: demo
- **Elements**:
  - Email input: `aria-label="login:email"`
  - Password input: `aria-label="login:password"`
  - Submit button: `aria-label="login:signIn"`

### Step 2: Tenant Selection (if multiple tenants)
After successful login, a tenant selection wizard appears.
- **Tenant cards**: `role="button"` with `aria-label="login:selectTenant:{TenantName}"`
- Click the button with `aria-label="login:selectTenant:Diessenhofen"`
- Logout option: `aria-label="login:signInDifferent"`

### Step 3: Account Selection (if multiple accounts in tenant)
If the tenant has multiple accounts, an account selection wizard appears.
- **Account cards**: `role="button"` with `aria-label="login:selectAccount:{AccountName}"`
- Example: Click the button with `aria-label="login:selectAccount:Diessenhofen 8253"`
- Back to tenant: `aria-label="login:backToTenant"`
